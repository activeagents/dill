<% content_for(:title) { @report.title } %>
<% @layout_class = "report" %>

<% content_for :head do %>
  <%= tag.meta property: "og:title", content: @report.title %>
  <%= tag.meta property: "og:description", content: @report.subtitle %>
  <%= tag.meta property: "og:image", content: @report.cover.blank? ? asset_url("covers/cover-#{@report.theme}-og.png") : "#{root_url}#{url_for(@report.cover)}" %>
  <%= tag.meta property: "og:url", content: report_slug_url(@report) %>

  <%= tag.meta property: "twitter:title", content: @report.title %>
  <%= tag.meta property: "twitter:description", content: @report.subtitle %>
  <%= tag.meta property: "twitter:image", content: @report.cover.blank? ? asset_url("covers/cover-#{@report.theme}-og.png") : "#{root_url}#{url_for(@report.cover)}" %>
  <%= tag.meta property: "twitter:card", content: "summary_large_image" %>
<% end %>

<% content_for :header do %>
  <nav class="report__navbar">
    <%= link_to root_path, class: "btn" do %>
      <%= image_tag "arrow-left.svg", aria: { hidden: true }, size: 24 %>
      <span class="for-screen-reader">Go back</span>
    <% end %>

    <span class="btn btn--placeholder placeholder-start" aria-hidden="true"></span>

    <div class="breadcrumbs">
      <%= render "reports/index_link" %>
      <span class="flex-item-no-shrink">â–¸</span>
      <strong><%= @report.title %></strong>
    </div>

    <%= link_to_first_sectionable(@sections) %>

    <span class="btn btn--placeholder placeholder-end" aria-hidden="true"></span>

    <button class="btn fullscreen" data-action="fullscreen#toggle" data-fullscreen-target="button">
      <%= image_tag "expand.svg", aria: { hidden: true }, size: 24 %>
      <span class="for-screen-reader">Enter fullscreen</span>
    </button>

    <%= render "reports/searches/search", report: @report %>

    <% if @report.editable? %>
      <%= link_to edit_report_path(@report), class: "btn settings" do %>
        <%= image_tag "settings.svg", aria: { hidden: true }, size: 24 %>
        <span class="for-screen-reader">Edit report settings</span>
      <% end %>
    <% end %>
  </nav>
<% end %>

<% cache [ @report, @report.editable? ] do %>
  <aside class="txt-align-center margin-block">
    <div class="report__sidebar <%= "theme--#{@report&.theme}" unless @report.cover.attached? %>">
      <% if @report.cover.attached? %>
        <%= link_to rails_blob_path(@report.cover, disposition: "attachment", only_path: true), data: { action: "lightbox#open:prevent", lightbox_target: "image", lightbox_url_value: rails_blob_path(@report.cover, disposition: "attachment", only_path: true) } do %>
          <%= image_tag @report.cover, alt: "Cover for #{ @report.title }", class: "report__cover margin-block-none center" %>
        <% end %>
      <% else %>
        <span class="report__cover-wrapper">
          <%= image_tag "empty-cover.png", alt: "Report cover", class: "report__cover margin-block-none center" %>
          <span class="report__title overflow-line-clamp pad txt-align-start txt-tight-lines" style="--lines: 6" aria-hidden="true"><%= @report.title %></span>
        </span>
      <% end %>

      <% if @report.editable? %>
        <%= turbo_frame_tag @report, :publication do %>
          <%= render "reports/publications/publication", report: @report %>
        <% end %>
      <% end %>

      <span data-controller="edit-mode" data-edit-mode-editing-class="edit-mode" />
    </div>
  </aside>

  <%= arrangement_tag @report, class: "arrangement__container toc__container full-width txt-align-center" do %>
    <h1 class="flex flex-column txt-tight-lines txt-align-start margin-block-end">
      <strong class="report__title txt-x-large--responsive"><%= @report.title %></strong>
      <span class="txt-large--responsive txt-normal"><%= @report.subtitle %></span>
      <span class="txt-large--responsive txt-normal"><%= @report.author %></span>
    </h1>

    <div class="report__toolbar fill-white flex gap-half pad-block margin-block-end-half justify-center <%= "position-sticky" if @report.editable? %>" data-controller="toc-view" data-toc-view-id-value="<%= dom_id(@report) %>">
      <label class="btn txt-medium disable-when-empty">
        <input type="radio" name="view" id="toc-list" value="list" data-toc-view-target="switch" data-toc-view-type-value="list" data-action="toc-view#saveViewPref">
        <%= image_tag "view-list.svg", aria: { hidden: true }, size: 24 %>
        <span class="for-screen-reader">List view</span>
      </label>

      <label class="btn txt-medium flex-item-justify-start disable-when-empty">
        <input type="radio" name="view" id="toc-grid" value="grid" checked="checked" data-toc-view-target="switch" data-toc-view-type-value="grid" data-action="toc-view#saveViewPref">
        <%= image_tag "view-grid.svg", aria: { hidden: true }, size: 24 %>
        <span class="for-screen-reader">Page view</span>
      </label>

      <% if @report.editable? %>
        <%= render "reports/create_buttons", report: @report %>
        <%= link_to report_sources_path(@report), class: "btn txt-medium", title: "Manage sources" do %>
          <%= image_tag "file.svg", aria: { hidden: true }, size: 24 %>
          <span class="for-screen-reader">Sources</span>
        <% end %>
        <%= render "reports/mode_buttons", report: @report %>
      <% end %>
    </div>

    <div class="position-relative">
      <% if @report.editable? %>
        <div class="toc__blank-slate align-center justify-start">
          <%= image_tag "blank-slate-arrows.svg", aria: { hidden: true }, size: 60, class: "colorize--black" %>
          <span class="flex align-center gap-half"><span>ğŸ‡ºğŸ‡¸</span> <span>Pick a page type to get started</span></span>
          <span class="flex align-center gap-half"><span>ğŸ‡ªğŸ‡¸</span> <span>Elige un tipo de pÃ¡gina para comenzar</span></span>
          <span class="flex align-center gap-half"><span>ğŸ‡«ğŸ‡·</span> <span>Choisissez un type de page pour commencer</span></span>
          <span class="flex align-center gap-half"><span>ğŸ‡®ğŸ‡³</span> <span>à¤¶à¥à¤°à¥‚ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤à¤• à¤ªà¥ƒà¤·à¥à¤  à¤ªà¥à¤°à¤•à¤¾à¤° à¤šà¥à¤¨à¥‡à¤‚</span></span>
          <span class="flex align-center gap-half"><span>ğŸ‡©ğŸ‡ª</span> <span>WÃ¤hlen Sie einen Seitentyp, um zu beginnen</span></span>
          <span class="flex align-center gap-half"><span>ğŸ‡§ğŸ‡·</span> <span>Escolha um tipo de pÃ¡gina para comeÃ§ar</span></span>
        </div>
      <% end %>

      <menu class="toc margin-none" tabindex="0" data-arrangement-target="container" data-action="<%= arrangement_actions %>">
        <%= turbo_frame_tag :sections, data: { arrangement_target: "list" } do -%>
          <%= render partial: "sections/section", collection: @sections, as: :section -%>
        <% end -%>
      </menu>

      <div data-arrangement-target="layer" class="toc"></div>
      <div data-arrangement-target="dragImage" class="arrangement-drag-image"></div>
    </div>
  <% end %>
<% end %>

<% content_for :footer do %>
  <nav class="report__nav flex align-center justify-center">
    <a href="https://dill.vc" class="product__wordmark btn btn--plain txt-medium" target="_blank">
      <span aria-hidden="true">ğŸ¥’</span>
      <span>Made with Dill</span>
    </a>
  </nav>
<% end %>
