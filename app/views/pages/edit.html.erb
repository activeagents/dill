<% content_for(:title) { "Edit #{ @page.title }" } %>

<% content_for :header do %>
  <%= render "sectionables/edit_header", section: @section, report: @report %>
<% end %>

<% content_for :toolbar do %>
  <div class="page-toolbar fill-selected align-center gap-half margin-block-end-double">
    <%= editing_mode_toggle_switch(@section, checked: true) %>

    <span class="separator margin-inline-half" aria-hidden="true"></span>

    <span class="overflow-y overflow-hide-scrollbar">
      <%= render "house_toolbar" %>
    </span>

    <span class="separator margin-inline-half" aria-hidden="true"></span>

    <%= render "sections/history", section: @section %>

    <%# References toggle button %>
    <button type="button"
            class="btn flex references-toggle txt-small"
            onclick="document.dispatchEvent(new CustomEvent('references-panel:toggle'))"
            title="Research Sources">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" />
      </svg>
      <% if @page.has_research_references? %>
        <span class="references-toggle__badge"><%= @page.research_references.count %></span>
      <% end %>
      <span class="for-screen-reader">Research Sources</span>
    </button>

    <button type="submit" form="sectionable-editor" class="btn flex page-toolbar__save flex-item-justify-end flex-item-no-shrink txt-small">
      <%= image_tag "check.svg", aria: { hidden: true }, size: 24 %>
      <span class="for-screen-reader">Save</span>
    </button>
  </div>
<% end %>

<% content_for :sidebar do %>
  <%= render "sections/sidebar", report: @report %>
<% end %>

<article class="layout--reading">
  <%= render "sections/being_edited_indicator", section: @section %>

  <%= render "pages/form", report: @report, page: @page %>
</article>

<%= render "sections/edit_footer", section: @section %>

<%# References panel for research sources %>
<%= render "references/panel", section: @section, report: @report %>
